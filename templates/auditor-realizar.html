<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Realizar Auditor√≠a</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/auditor.css') }}">
</head>
<body>
    <div class="rc-header">
        <a href="/auditor" class="rc-back">‚Äπ</a>
        <h1 class="rc-screen-title">Nueva Auditor√≠a</h1>
        <div></div>
    </div>

    <div class="rc-container">
        <form id="formAuditoria">
            <!-- Informaci√≥n General -->
            <div class="section-title">üìã INFORMACI√ìN GENERAL</div>
            <div class="question-block">
                <label class="question-text">Fecha de la auditor√≠a:</label>
                <input type="date" id="fecha" name="fecha" required style="width:100%; padding:10px; background:#2a2a2a; border:1px solid #ab925c; color:#fff; border-radius:5px;">
            </div>

            <!-- Secci√≥n 1: Pol√≠tica Ambiental -->
            <div class="section-title">üåç 1. POL√çTICA AMBIENTAL</div>
            
            <div class="question-block">
                <p class="question-text">1.1 ¬øLa organizaci√≥n cuenta con una pol√≠tica ambiental documentada?</p>
                <label class="option-label">
                    <input type="radio" name="q1_1" value="Cumple" required>
                    <span>‚úÖ Cumple</span>
                </label>
                <label class="option-label">
                    <input type="radio" name="q1_1" value="Parcialmente">
                    <span>‚ö†Ô∏è Parcialmente</span>
                </label>
                <label class="option-label">
                    <input type="radio" name="q1_1" value="No Cumple">
                    <span>‚ùå No Cumple</span>
                </label>
            </div>

            <div class="question-block">
                <p class="question-text">1.2 ¬øLa pol√≠tica ambiental est√° disponible para todas las partes interesadas?</p>
                <label class="option-label">
                    <input type="radio" name="q1_2" value="Cumple" required>
                    <span>‚úÖ Cumple</span>
                </label>
                <label class="option-label">
                    <input type="radio" name="q1_2" value="Parcialmente">
                    <span>‚ö†Ô∏è Parcialmente</span>
                </label>
                <label class="option-label">
                    <input type="radio" name="q1_2" value="No Cumple">
                    <span>‚ùå No Cumple</span>
                </label>
            </div>

            <!-- Secci√≥n 2: Planificaci√≥n -->
            <div class="section-title">üìä 2. PLANIFICACI√ìN</div>
            
            <div class="question-block">
                <p class="question-text">2.1 ¬øSe han identificado los aspectos ambientales significativos?</p>
                <label class="option-label">
                    <input type="radio" name="q2_1" value="Cumple" required>
                    <span>‚úÖ Cumple</span>
                </label>
                <label class="option-label">
                    <input type="radio" name="q2_1" value="Parcialmente">
                    <span>‚ö†Ô∏è Parcialmente</span>
                </label>
                <label class="option-label">
                    <input type="radio" name="q2_1" value="No Cumple">
                    <span>‚ùå No Cumple</span>
                </label>
            </div>

            <div class="question-block">
                <p class="question-text">2.2 ¬øExisten objetivos ambientales medibles y coherentes con la pol√≠tica?</p>
                <label class="option-label">
                    <input type="radio" name="q2_2" value="Cumple" required>
                    <span>‚úÖ Cumple</span>
                </label>
                <label class="option-label">
                    <input type="radio" name="q2_2" value="Parcialmente">
                    <span>‚ö†Ô∏è Parcialmente</span>
                </label>
                <label class="option-label">
                    <input type="radio" name="q2_2" value="No Cumple">
                    <span>‚ùå No Cumple</span>
                </label>
            </div>

            <!-- Secci√≥n 3: Implementaci√≥n -->
            <div class="section-title">‚öôÔ∏è 3. IMPLEMENTACI√ìN Y OPERACI√ìN</div>
            
            <div class="question-block">
                <p class="question-text">3.1 ¬øSe han definido roles y responsabilidades ambientales?</p>
                <label class="option-label">
                    <input type="radio" name="q3_1" value="Cumple" required>
                    <span>‚úÖ Cumple</span>
                </label>
                <label class="option-label">
                    <input type="radio" name="q3_1" value="Parcialmente">
                    <span>‚ö†Ô∏è Parcialmente</span>
                </label>
                <label class="option-label">
                    <input type="radio" name="q3_1" value="No Cumple">
                    <span>‚ùå No Cumple</span>
                </label>
            </div>

            <div class="question-block">
                <p class="question-text">3.2 ¬øEl personal est√° capacitado en temas ambientales relevantes?</p>
                <label class="option-label">
                    <input type="radio" name="q3_2" value="Cumple" required>
                    <span>‚úÖ Cumple</span>
                </label>
                <label class="option-label">
                    <input type="radio" name="q3_2" value="Parcialmente">
                    <span>‚ö†Ô∏è Parcialmente</span>
                </label>
                <label class="option-label">
                    <input type="radio" name="q3_2" value="No Cumple">
                    <span>‚ùå No Cumple</span>
                </label>
            </div>

            <div class="question-block">
                <p class="question-text">3.3 ¬øExisten procedimientos documentados para las operaciones cr√≠ticas?</p>
                <label class="option-label">
                    <input type="radio" name="q3_3" value="Cumple" required>
                    <span>‚úÖ Cumple</span>
                </label>
                <label class="option-label">
                    <input type="radio" name="q3_3" value="Parcialmente">
                    <span>‚ö†Ô∏è Parcialmente</span>
                </label>
                <label class="option-label">
                    <input type="radio" name="q3_3" value="No Cumple">
                    <span>‚ùå No Cumple</span>
                </label>
            </div>

            <!-- Secci√≥n 4: Verificaci√≥n -->
            <div class="section-title">‚úîÔ∏è 4. VERIFICACI√ìN</div>
            
            <div class="question-block">
                <p class="question-text">4.1 ¬øSe monitorean y miden las operaciones con impacto ambiental?</p>
                <label class="option-label">
                    <input type="radio" name="q4_1" value="Cumple" required>
                    <span>‚úÖ Cumple</span>
                </label>
                <label class="option-label">
                    <input type="radio" name="q4_1" value="Parcialmente">
                    <span>‚ö†Ô∏è Parcialmente</span>
                </label>
                <label class="option-label">
                    <input type="radio" name="q4_1" value="No Cumple">
                    <span>‚ùå No Cumple</span>
                </label>
            </div>

            <div class="question-block">
                <p class="question-text">4.2 ¬øSe realizan auditor√≠as internas peri√≥dicas del sistema ambiental?</p>
                <label class="option-label">
                    <input type="radio" name="q4_2" value="Cumple" required>
                    <span>‚úÖ Cumple</span>
                </label>
                <label class="option-label">
                    <input type="radio" name="q4_2" value="Parcialmente">
                    <span>‚ö†Ô∏è Parcialmente</span>
                </label>
                <label class="option-label">
                    <input type="radio" name="q4_2" value="No Cumple">
                    <span>‚ùå No Cumple</span>
                </label>
            </div>

            <!-- Secci√≥n 5: Mejora Continua -->
            <div class="section-title">üìà 5. MEJORA CONTINUA</div>
            
            <div class="question-block">
                <p class="question-text">5.1 ¬øSe implementan acciones correctivas y preventivas?</p>
                <label class="option-label">
                    <input type="radio" name="q5_1" value="Cumple" required>
                    <span>‚úÖ Cumple</span>
                </label>
                <label class="option-label">
                    <input type="radio" name="q5_1" value="Parcialmente">
                    <span>‚ö†Ô∏è Parcialmente</span>
                </label>
                <label class="option-label">
                    <input type="radio" name="q5_1" value="No Cumple">
                    <span>‚ùå No Cumple</span>
                </label>
            </div>

            <div class="question-block">
                <p class="question-text">5.2 ¬øLa direcci√≥n revisa peri√≥dicamente el sistema de gesti√≥n ambiental?</p>
                <label class="option-label">
                    <input type="radio" name="q5_2" value="Cumple" required>
                    <span>‚úÖ Cumple</span>
                </label>
                <label class="option-label">
                    <input type="radio" name="q5_2" value="Parcialmente">
                    <span>‚ö†Ô∏è Parcialmente</span>
                </label>
                <label class="option-label">
                    <input type="radio" name="q5_2" value="No Cumple">
                    <span>‚ùå No Cumple</span>
                </label>
            </div>

            <button type="submit" class="btn-generate-pdf">üìÑ Generar Reporte PDF</button>
        </form>

        <div id="mensaje" style="margin-top:20px; text-align:center; color:#ab925c;"></div>
    </div>

    <script>
        document.getElementById('formAuditoria').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const respuestas = {};
            
            // Recopilar todas las respuestas
            for (let [key, value] of formData.entries()) {
                if (key !== 'fecha') {
                    const pregunta = document.querySelector(`input[name="${key}"]`)
                        .closest('.question-block')
                        .querySelector('.question-text').textContent;
                    respuestas[pregunta] = value;
                }
            }
            
            const datos = {
                fecha: formData.get('fecha'),
                respuestas: respuestas
            };
            
            try {
                const response = await fetch('/api/guardar_checklist', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(datos)
                });
                
                const resultado = await response.json();
                const mensaje = document.getElementById('mensaje');
                
                if (resultado.exito) {
                    mensaje.innerHTML = `‚úÖ Auditor√≠a guardada. <a href="${resultado.pdf_url}" style="color:#ab925c; text-decoration:underline;">Descargar PDF</a>`;
                    this.reset();
                } else {
                    mensaje.innerHTML = `‚ùå Error: ${resultado.mensaje}`;
                }
            } catch (error) {
                document.getElementById('mensaje').innerHTML = `‚ùå Error de conexi√≥n: ${error}`;
            }
        });
    </script>
</body>
</html>
